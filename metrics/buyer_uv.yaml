metric:
  name: Buyer UV
  aliases: ["buyer count", "买家数", "buyer uv"]
  type: simple
  aggregation: avg
  unit: count
  sources:
    - id: buyer_uv
      layer: dwd
      table: traffic_omni_oa.dwd_order_item_atc_journey_di__reg_sensitive_live
      columns:
        value: "count(distinct case when gmv_usd * atc_prorate * first_touchpoint_item > 0 then user_id end)"
        date: grass_date
        region: grass_region
      filters:
        - "tz_type = 'local'"
        - "first_touchpoint_item = 1"
        - "user_id > 0"
        - "user_id is not null"
        - "order_item_id is not null"
      use_when:
        granularity: [platform]
  dimensions:
    required: [market, date_range]
    optional: []
